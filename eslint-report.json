[{"filePath":"/Users/tomhoward/Projects/dry-aged-deps/src/age-calculator.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/tomhoward/Projects/dry-aged-deps/src/apply-filters.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/tomhoward/Projects/dry-aged-deps/src/build-rows.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/tomhoward/Projects/dry-aged-deps/src/check-vulnerabilities.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/tomhoward/Projects/dry-aged-deps/src/cli-options-helpers.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/tomhoward/Projects/dry-aged-deps/src/cli-options.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/tomhoward/Projects/dry-aged-deps/src/config-loader.js","messages":[{"ruleId":"complexity","severity":2,"message":"Function 'loadConfigFile' has a complexity of 41. Maximum allowed is 20.","line":13,"column":8,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":13,"endColumn":31}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from 'fs';\nimport path from 'path';\n\n/**\n * Load and validate configuration from a config file.\n *\n * @param {string} configFileName - Name of the config file to load (relative to cwd).\n * @param {string|undefined} configFileArg - The raw CLI argument for config file (if provided).\n * @param {string[]} validSeverities - List of valid severity values.\n * @param {string[]} validFormats - List of valid format values.\n * @returns {object} The parsed config object (empty if no config file found).\n */\nexport function loadConfigFile(\n  configFileName,\n  configFileArg,\n  validSeverities,\n  validFormats\n) {\n  const configFilePath = path.resolve(process.cwd(), configFileName);\n  let config = {};\n\n  if (fs.existsSync(configFilePath)) {\n    let rawConfig;\n    try {\n      rawConfig = fs.readFileSync(configFilePath, 'utf8');\n      config = JSON.parse(rawConfig);\n    } catch (err) {\n      console.error(\n        `Invalid JSON in config file ${configFileName}: ${err.message}`\n      );\n      process.exit(2);\n    }\n\n    if (\n      typeof config !== 'object' ||\n      config === null ||\n      Array.isArray(config)\n    ) {\n      console.error(\n        `Invalid config format in ${configFileName}: must be a JSON object`\n      );\n      process.exit(2);\n    }\n\n    const allowedTopKeys = ['minAge', 'severity', 'prod', 'dev', 'format'];\n    for (const key of Object.keys(config)) {\n      if (!allowedTopKeys.includes(key)) {\n        console.error(`Unknown config key: ${key} in ${configFileName}`);\n        process.exit(2);\n      }\n    }\n\n    if (config.minAge !== undefined) {\n      if (\n        !Number.isInteger(config.minAge) ||\n        config.minAge < 1 ||\n        config.minAge > 365\n      ) {\n        console.error(\n          `Invalid config value for minAge: ${config.minAge}. Must be integer 1-365`\n        );\n        process.exit(2);\n      }\n    }\n\n    if (config.severity !== undefined) {\n      if (!validSeverities.includes(config.severity)) {\n        console.error(\n          `Invalid config value for severity: ${config.severity}. Valid values: ${validSeverities.join(', ')}`\n        );\n        process.exit(2);\n      }\n    }\n\n    if (config.format !== undefined) {\n      if (!validFormats.includes(config.format)) {\n        console.error(\n          `Invalid config value for format: ${config.format}. Valid values: ${validFormats.join(', ')}`\n        );\n        process.exit(2);\n      }\n    }\n\n    if (config.prod !== undefined) {\n      if (\n        typeof config.prod !== 'object' ||\n        config.prod === null ||\n        Array.isArray(config.prod)\n      ) {\n        console.error(`Invalid config value for prod: must be an object`);\n        process.exit(2);\n      }\n\n      const allowedProdKeys = ['minAge', 'minSeverity'];\n      for (const key of Object.keys(config.prod)) {\n        if (!allowedProdKeys.includes(key)) {\n          console.error(`Unknown config key in prod: ${key}`);\n          process.exit(2);\n        }\n      }\n\n      if (config.prod.minAge !== undefined) {\n        if (\n          !Number.isInteger(config.prod.minAge) ||\n          config.prod.minAge < 1 ||\n          config.prod.minAge > 365\n        ) {\n          console.error(\n            `Invalid config value for prod.minAge: ${config.prod.minAge}. Must be integer 1-365`\n          );\n          process.exit(2);\n        }\n      }\n\n      if (config.prod.minSeverity !== undefined) {\n        if (!validSeverities.includes(config.prod.minSeverity)) {\n          console.error(\n            `Invalid config value for prod.minSeverity: ${config.prod.minSeverity}. Valid values: ${validSeverities.join(', ')}`\n          );\n          process.exit(2);\n        }\n      }\n    }\n\n    if (config.dev !== undefined) {\n      if (\n        typeof config.dev !== 'object' ||\n        config.dev === null ||\n        Array.isArray(config.dev)\n      ) {\n        console.error(`Invalid config value for dev: must be an object`);\n        process.exit(2);\n      }\n\n      const allowedDevKeys = ['minAge', 'minSeverity'];\n      for (const key of Object.keys(config.dev)) {\n        if (!allowedDevKeys.includes(key)) {\n          console.error(`Unknown config key in dev: ${key}`);\n          process.exit(2);\n        }\n      }\n\n      if (config.dev.minAge !== undefined) {\n        if (\n          !Number.isInteger(config.dev.minAge) ||\n          config.dev.minAge < 1 ||\n          config.dev.minAge > 365\n        ) {\n          console.error(\n            `Invalid config value for dev.minAge: ${config.dev.minAge}. Must be integer 1-365`\n          );\n          process.exit(2);\n        }\n      }\n\n      if (config.dev.minSeverity !== undefined) {\n        if (!validSeverities.includes(config.dev.minSeverity)) {\n          console.error(\n            `Invalid config value for dev.minSeverity: ${config.dev.minSeverity}. Valid values: ${validSeverities.join(', ')}`\n          );\n          process.exit(2);\n        }\n      }\n    }\n  } else if (configFileArg) {\n    console.error(`Configuration file not found: ${configFileName}`);\n    process.exit(2);\n  }\n\n  return config;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/tomhoward/Projects/dry-aged-deps/src/fetch-version-times.js","messages":[],"suppressedMessages":[{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":42,"column":11,"nodeType":"MemberExpression","endLine":42,"endColumn":32,"suppressions":[{"kind":"directive","justification":"safe iteration"}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/tomhoward/Projects/dry-aged-deps/src/filter-by-age.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/tomhoward/Projects/dry-aged-deps/src/filter-by-security.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/tomhoward/Projects/dry-aged-deps/src/index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/tomhoward/Projects/dry-aged-deps/src/json-formatter.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/tomhoward/Projects/dry-aged-deps/src/load-package-json.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/tomhoward/Projects/dry-aged-deps/src/print-outdated-handlers.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/tomhoward/Projects/dry-aged-deps/src/print-outdated.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/tomhoward/Projects/dry-aged-deps/src/update-packages.js","messages":[],"suppressedMessages":[{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":59,"column":9,"nodeType":"MemberExpression","endLine":59,"endColumn":35,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":62,"column":9,"nodeType":"MemberExpression","endLine":62,"endColumn":38,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/tomhoward/Projects/dry-aged-deps/src/xml-formatter.js","messages":[{"ruleId":"complexity","severity":2,"message":"Function 'xmlFormatter' has a complexity of 33. Maximum allowed is 20.","line":28,"column":8,"nodeType":"FunctionDeclaration","messageId":"complex","endLine":28,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// xml-formatter.js\n// Formats outdated dependencies and summary data into XML\n\n/**\n * Escape special XML characters in a string\n * @param {string} unsafe\n * @returns {string}\n */\nfunction escapeXml(unsafe) {\n  return String(unsafe)\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&apos;');\n}\n\n/**\n * Format data into XML string\n * @param {Object} params\n * @param {Array<any>} [params.rows]\n * @param {Object} [params.summary]\n * @param {Object} [params.thresholds]\n * @param {string} [params.timestamp]\n * @param {Error} [params.error]\n * @returns {string} XML string\n */\nexport function xmlFormatter({\n  rows = [],\n  summary = {},\n  thresholds = {},\n  timestamp = '',\n  error = null,\n} = {}) {\n  let xml = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n';\n  xml += `<outdated-packages timestamp=\"${escapeXml(timestamp)}\">\\n`;\n\n  // Error output\n  if (error) {\n    xml += '  <error>\\n';\n    xml += `    <message>${escapeXml(error.message)}</message>\\n`;\n    xml += `    <code>${escapeXml(error.code || '')}</code>\\n`;\n    if (error.details) {\n      xml += `    <details>${escapeXml(error.details)}</details>\\n`;\n    }\n    xml += '  </error>\\n';\n    xml += '</outdated-packages>';\n    return xml;\n  }\n\n  // Packages\n  xml += '  <packages>\\n';\n  for (const item of rows) {\n    xml += '    <package>\\n';\n    if (Array.isArray(item)) {\n      const [name, current, wanted, latest, age] = item;\n      xml += `      <name>${escapeXml(name)}</name>\\n`;\n      xml += `      <current>${escapeXml(current)}</current>\\n`;\n      xml += `      <wanted>${escapeXml(wanted)}</wanted>\\n`;\n      xml += `      <latest>${escapeXml(latest)}</latest>\\n`;\n      xml += `      <age>${escapeXml(age)}</age>\\n`;\n    } else {\n      // object-style item\n      xml += `      <name>${escapeXml(item.name)}</name>\\n`;\n      xml += `      <current>${escapeXml(item.current)}</current>\\n`;\n      xml += `      <wanted>${escapeXml(item.wanted)}</wanted>\\n`;\n      xml += `      <latest>${escapeXml(item.latest)}</latest>\\n`;\n      xml += `      <age>${escapeXml(item.age)}</age>\\n`;\n      xml += `      <recommended>${escapeXml(item.recommended)}</recommended>\\n`;\n      // Vulnerabilities block\n      xml += '      <vulnerabilities>\\n';\n      const vuln = item.vulnerabilities || {};\n      const count = vuln.count != null ? vuln.count : '';\n      const maxSeverity = vuln.maxSeverity || '';\n      xml += `        <count>${escapeXml(count)}</count>\\n`;\n      xml += `        <max-severity>${escapeXml(maxSeverity)}</max-severity>\\n`;\n      xml += '        <details>\\n';\n      if (Array.isArray(vuln.details)) {\n        for (const detail of vuln.details) {\n          xml += '          <vulnerability>\\n';\n          xml += `            <name>${escapeXml(detail.name)}</name>\\n`;\n          xml += `            <severity>${escapeXml(detail.severity)}</severity>\\n`;\n          xml += `            <title>${escapeXml(detail.title)}</title>\\n`;\n          xml += `            <url>${escapeXml(detail.url)}</url>\\n`;\n          xml += '          </vulnerability>\\n';\n        }\n      }\n      xml += '        </details>\\n';\n      xml += '      </vulnerabilities>\\n';\n      xml += `      <filtered>${item.filtered === true}</filtered>\\n`;\n      xml += `      <filter-reason>${escapeXml(item.filterReason || '')}</filter-reason>\\n`;\n      xml += `      <dependency-type>${escapeXml(item.dependencyType || '')}</dependency-type>\\n`;\n    }\n    xml += '    </package>\\n';\n  }\n  xml += '  </packages>\\n';\n\n  // Summary\n  xml += '  <summary>\\n';\n  xml += `    <total-outdated>${escapeXml(summary.totalOutdated ?? 0)}</total-outdated>\\n`;\n  xml += `    <safe-updates>${escapeXml(summary.safeUpdates ?? 0)}</safe-updates>\\n`;\n  xml += `    <filtered-by-age>${escapeXml(summary.filteredByAge ?? 0)}</filtered-by-age>\\n`;\n  xml += `    <filtered-by-security>${escapeXml(summary.filteredBySecurity ?? 0)}</filtered-by-security>\\n`;\n  if (summary.minAge != null) {\n    xml += `    <min-age>${escapeXml(summary.minAge)}</min-age>\\n`;\n  }\n  xml += '  </summary>\\n';\n\n  // Thresholds\n  if (thresholds && (thresholds.prod || thresholds.dev)) {\n    xml += '  <thresholds>\\n';\n    if (thresholds.prod) {\n      xml += '    <prod>\\n';\n      if (thresholds.prod.minAge != null) {\n        xml += `      <min-age>${escapeXml(thresholds.prod.minAge)}</min-age>\\n`;\n      }\n      if (thresholds.prod.minSeverity != null) {\n        xml += `      <min-severity>${escapeXml(thresholds.prod.minSeverity)}</min-severity>\\n`;\n      }\n      xml += '    </prod>\\n';\n    }\n    if (thresholds.dev) {\n      xml += '    <dev>\\n';\n      if (thresholds.dev.minAge != null) {\n        xml += `      <min-age>${escapeXml(thresholds.dev.minAge)}</min-age>\\n`;\n      }\n      if (thresholds.dev.minSeverity != null) {\n        xml += `      <min-severity>${escapeXml(thresholds.dev.minSeverity)}</min-severity>\\n`;\n      }\n      xml += '    </dev>\\n';\n    }\n    xml += '  </thresholds>\\n';\n  }\n\n  xml += '</outdated-packages>';\n  return xml;\n}\n","usedDeprecatedRules":[]}]
