/**
 * Tests for unexpected audit output handling in evaluateVersionVulnerabilities
 * @supports prompts/004.0-DEV-FILTER-VULNERABLE-VERSIONS.md REQ-SAFE-ONLY
 */

import { describe, it, expect } from 'vitest';
import { evaluateVersionVulnerabilities } from '../src/vulnerability-evaluator.js';

describe('Story 004.0-DEV-FILTER-VULNERABLE-VERSIONS: evaluateVersionVulnerabilities unexpected audit output', () => {
  it('[REQ-SAFE-ONLY] treats string result as safe with no vulnerabilities', async () => {
    const checkVulnerabilities = async () => 'unexpected';
    const severityWeights = { none: 0, low: 1, moderate: 2, high: 3, critical: 4 };
    const result = await evaluateVersionVulnerabilities('pkg', '1.0.0', checkVulnerabilities, 'low', severityWeights);
    expect(result).toEqual({ safe: true, totalCount: 0, maxSeverity: 'none', detailsList: [] });
  });

  it('[REQ-SAFE-ONLY] treats undefined result as safe with no vulnerabilities', async () => {
    const checkVulnerabilities = async () => undefined;
    const severityWeights = { none: 0, low: 1, moderate: 2, high: 3, critical: 4 };
    const result = await evaluateVersionVulnerabilities('pkg', '1.0.0', checkVulnerabilities, 'high', severityWeights);
    expect(result).toEqual({ safe: true, totalCount: 0, maxSeverity: 'none', detailsList: [] });
  });
});
