/**
 * @story prompts/dry-aged-deps-user-story-map.md
 * @req UNKNOWN - TODO: specify requirement ID and description
 */
/**
 * @story prompts/dry-aged-deps-user-story-map.md
 *//**
 * @story prompts/dry-aged-deps-user-story-map.md
 *//**
 * Story: prompts/004.0-DEV-FILTER-VULNERABLE-VERSIONS.md
 * @req REQ-UNEXPECTED-FORMAT - Handle unexpected output from checkVulnerabilities gracefully
 */
import { describe, it, expect } from 'vitest';
import { evaluateVersionVulnerabilities } from '../src/vulnerability-evaluator.js';

describe('evaluateVersionVulnerabilities unexpected audit output', () => {
  it('treats string result as safe with no vulnerabilities', async () => {
    const checkVulnerabilities = async () => 'unexpected';
    const severityWeights = { none: 0, low: 1, moderate: 2, high: 3, critical: 4 };
    const result = await evaluateVersionVulnerabilities('pkg', '1.0.0', checkVulnerabilities, 'low', severityWeights);
    expect(result).toEqual({ safe: true, totalCount: 0, maxSeverity: 'none', detailsList: [] });
  });

  it('treats undefined result as safe with no vulnerabilities', async () => {
    const checkVulnerabilities = async () => undefined;
    const severityWeights = { none: 0, low: 1, moderate: 2, high: 3, critical: 4 };
    const result = await evaluateVersionVulnerabilities('pkg', '1.0.0', checkVulnerabilities, 'high', severityWeights);
    expect(result).toEqual({ safe: true, totalCount: 0, maxSeverity: 'none', detailsList: [] });
  });
});
