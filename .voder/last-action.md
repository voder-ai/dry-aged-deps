# Last Action Executed (Agentic)

**Action:** Used tool: list_directory with input: {"dirPath":"test/helpers"}
Used tool: read_file with input: {"filePath":"test/helpers/cli.outdated.mock.js","startLine":1,"endLine":300}
Used tool: list_directory with input: {"dirPath":"src"}
Used tool: read_file with input: {"filePath":"test/cli.outdated.test.js","startLine":1,"endLine":300}
Used tool: read_file with input: {"filePath":"src/print-outdated.js","startLine":1,"endLine":300}
Used tool: read_file with input: {"filePath":"src/check-vulnerabilities.js","startLine":1,"endLine":300}
Used tool: read_file with input: {"filePath":"src/fetch-version-times.js","startLine":1,"endLine":200}
Used tool: read_file with input: {"filePath":"bin/dry-aged-deps.js","startLine":1,"endLine":300}
Used tool: read_file with input: {"filePath":"test/helpers/cli-helper.js","startLine":1,"endLine":300}
Used tool: read_file with input: {"filePath":"src/age-calculator.js","startLine":1,"endLine":200}
Used tool: read_file with input: {"filePath":"package.json","startLine":1,"endLine":200}
Used tool: read_file with input: {"filePath":"vitest.config.js","startLine":1,"endLine":200}
Used tool: read_file with input: {"filePath":"src/print-outdated.js","startLine":100,"endLine":200}
Used tool: read_file with input: {"filePath":"test/fixtures/package.json","startLine":1,"endLine":100}
Used tool: read_file with input: {"filePath":"test/fetch-version-times.test.js","startLine":1,"endLine":200}
Used tool: read_file with input: {"filePath":"test/cli.upToDate.test.js","startLine":1,"endLine":200}
Used tool: read_file with input: {"filePath":"src/print-outdated.js","startLine":200,"endLine":300}
Used tool: generate_file with input: {"filePath":"test/cli.outdated.mock.test.js","content":"import { describe, it, expect } from 'vitest';\nimport { execa } from 'execa';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n// Import mock to stub npm outdated and npm view\nimport './helpers/cli.outdated.mock.js';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\nconst cliPath = path.join(__dirname, '..', 'bin', 'dry-aged-deps.js');\n\ndescribe('dry-aged-deps CLI mocked outdated output', () => {\n  it('prints mocked outdated package information', async () => {\n    const result = await execa('node', [cliPath]);\n    // Ensure exit code is zero\n    expect(result.exitCode).toBe(0);\n\n    const stdout = result.stdout;\n    // Check header and table\n    expect(stdout).toContain('Outdated packages:');\n    expect(stdout).toContain('Name\\tCurrent\\tWanted\\tLatest\\tAge (days)');\n\n    // Check that fakepkg row is present with correct version numbers\n    expect(stdout).toContain('fakepkg');\n    expect(stdout).toContain('1.0.0');\n    expect(stdout).toContain('1.1.0');\n    expect(stdout).toContain('2.0.0');\n  });\n});\n"}
Used tool: modify_file with input: {"filePath":"test/helpers/cli.outdated.mock.js","instruction":"Modify to set an env var so CLI process can detect mock mode.\nAdd at the end: `process.env.DRY_AGED_DEPS_CLI_MOCK = '1';`"}
Used tool: modify_file with input: {"filePath":"bin/dry-aged-deps.js","instruction":"Refactor CLI to support test mode stubbing via DRY_AGED_DEPS_CLI_MOCK env var and dynamic import stub file.\n1. Remove static imports of execFileSync and printOutdated; use dynamic imports inside async main().\n2. Add async function main() wrapping CLI logic.\n3. At top, import fs, path, fileURLToPath, pathToFileURL.\n4. In main(), if process.env.DRY_AGED_DEPS_CLI_MOCK === '1', dynamic import stub file test/helpers/cli.outdated.mock.js.\n5. Dynamic import child_process and printOutdated after stub load.\n6. Move CLI logic inside main.\n7. Call main().catch to handle errors.\n\nPlease replace the entire content accordingly, preserving shebang at top."}
Used tool: generate_file with input: {"filePath":"test/helpers/cli.outdated.mock.js","overwrite":true,"content":"// test/helpers/cli.outdated.mock.js\n// Stub module for dry-aged-deps CLI outdated testing\n\n// Export stub data for outdated dependencies\nexport const outdatedData = {\n  fakepkg: { current: '1.0.0', wanted: '1.1.0', latest: '2.0.0' },\n};\n\n// Stub fetchVersionTimes to return fixed publish dates\nexport async function fetchVersionTimes(packageName) {\n  // Return ISO date strings for versions\n  return {\n    '1.0.0': '2023-01-01T00:00:00Z',\n    '1.1.0': '2023-06-01T00:00:00Z',\n    '2.0.0': '2023-12-01T00:00:00Z',\n  };\n}\n\n// Stub checkVulnerabilities to always return 0 (no vulnerabilities)\nexport async function checkVulnerabilities(packageName, version) {\n  return 0;\n}"}
Used tool: generate_file with input: {"filePath":"bin/dry-aged-deps.js","overwrite":true,"content":"#!/usr/bin/env node\n\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath, pathToFileURL } from 'url';\nimport { execFileSync } from 'child_process';\nimport { printOutdated } from '../src/print-outdated.js';\n\n/**\n * dry-aged-deps CLI\n * Lists outdated npm dependencies and shows how long they have been outdated.\n */\nasync function main() {\n  // Resolve __dirname for ESM\n  const __filename = fileURLToPath(import.meta.url);\n  const __dirname = path.dirname(__filename);\n\n  // CLI arguments\n  const args = process.argv.slice(2);\n\n  // Help flag\n  if (args.includes('-h') || args.includes('--help')) {\n    console.log('Usage: dry-aged-deps [options]');\n    console.log('');\n    console.log('Options:');\n    console.log('  -h, --help             Show help');\n    console.log('  -v, --version          Show version');\n    console.log(\n      '  --format=<format>      Output format: table (default), json, xml'\n    );\n    process.exit(0);\n  }\n\n  // Version flag\n  if (args.includes('-v') || args.includes('--version')) {\n    const pkgPath = path.join(__dirname, '..', 'package.json');\n    const pkgJson = JSON.parse(fs.readFileSync(pkgPath, 'utf8'));\n    console.log(pkgJson.version);\n    process.exit(0);\n  }\n\n  // Format flag parsing\n  const validFormats = ['table', 'json', 'xml'];\n  let format = 'table';\n  // Support --format=value\n  const formatArg = args.find((arg) => arg.startsWith('--format='));\n  if (formatArg) {\n    format = formatArg.split('=')[1];\n  } else {\n    // Support --format value\n    const idx = args.indexOf('--format');\n    if (idx !== -1 && args.length > idx + 1) {\n      format = args[idx + 1];\n    }\n  }\n  // Validate format\n  if (!validFormats.includes(format)) {\n    console.error(\n      `Invalid format: ${format}. Valid values are: ${validFormats.join(', ')}`\n    );\n    process.exit(2);\n  }\n\n  let data;\n  let fetchVersionTimesOverride;\n  let checkVulnerabilitiesOverride;\n\n  if (process.env.DRY_AGED_DEPS_MOCK === '1') {\n    // Load mock module for testing\n    const mockPath = pathToFileURL(\n      path.resolve(__dirname, '../test/helpers/cli.outdated.mock.js')\n    ).href;\n    const mock = await import(mockPath);\n    data = mock.outdatedData;\n    fetchVersionTimesOverride = mock.fetchVersionTimes;\n    checkVulnerabilitiesOverride = mock.checkVulnerabilities;\n  } else {\n    // Run npm outdated in JSON mode\n    try {\n      const outputStr = execFileSync('npm', ['outdated', '--json'], {\n        encoding: 'utf8',\n      });\n      data = outputStr ? JSON.parse(outputStr) : {};\n    } catch (err) {\n      // npm outdated exits non-zero if updates exist\n      if (err.stdout) {\n        try {\n          data = JSON.parse(err.stdout.toString() || '{}');\n        } catch (parseErr) {\n          console.error(\n            'Failed to parse npm outdated output:',\n            parseErr.message\n          );\n          process.exit(1);\n        }\n      } else {\n        console.error('Error running npm outdated:', err.message);\n        process.exit(1);\n      }\n    }\n  }\n\n  // Print results\n  try {\n    await printOutdated(data, {\n      format,\n      fetchVersionTimes: fetchVersionTimesOverride,\n      checkVulnerabilities: checkVulnerabilitiesOverride,\n    });\n    process.exit(0);\n  } catch (err) {\n    console.error(err.message);\n    process.exit(1);\n  }\n}\n\nmain().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n"}
Used tool: read_file with input: {"filePath":"test/cli.outdated.mock.test.js","startLine":1,"endLine":200}
Used tool: modify_file with input: {"filePath":"test/cli.outdated.mock.test.js","instruction":"Remove import of './helpers/cli.outdated.mock.js'; and set DRY_AGED_DEPS_MOCK env var when calling execa.\n\nSpecifically:\n- Delete line: import './helpers/cli.outdated.mock.js';\n- Change execa invocation to: `await execa('node', [cliPath], { env: { ...process.env, DRY_AGED_DEPS_MOCK: '1' } });`"}
Used tool: read_file with input: {"filePath":"test/cli.outdated.mock.test.js","startLine":1,"endLine":200}
Used tool: modify_file with input: {"filePath":"test/helpers/cli.outdated.mock.js","instruction":"Update stub fetchVersionTimes dates to be in the distant past so age>=7 days. Replace date values with '2020-01-01T00:00:00Z', '2020-06-01T00:00:00Z', '2020-12-01T00:00:00Z'"}
Used tool: generate_file with input: {"filePath":"test/cli.outdated.mock.test.js","overwrite":true,"content":"import { describe, it, expect } from 'vitest';\nimport { execa } from 'execa';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\nconst cliPath = path.join(__dirname, 'bin', '..', 'bin', 'dry-aged-deps.js');\n\ndescribe('dry-aged-deps CLI mocked outdated output', () => {\n  it('prints mocked outdated package information', async () => {\n    const result = await execa('node', [cliPath], {\n      env: { ...process.env, DRY_AGED_DEPS_MOCK: '1' },\n    });\n    expect(result.exitCode).toBe(0);\n\n    const stdout = result.stdout;\n    expect(stdout).toContain('Outdated packages:');\n    expect(stdout).toContain('Name\\tCurrent\\tWanted\\tLatest\\tAge (days)');\n    expect(stdout).toContain('fakepkg\\t1.0.0\\t1.1.0\\t2.0.0');\n  });\n});\n"}
Used tool: read_file with input: {"filePath":"test/cli.outdated.mock.test.js","startLine":1,"endLine":200}
Used tool: generate_file with input: {"filePath":"test/cli.outdated.mock.test.js","overwrite":true,"content":"import { describe, it, expect } from 'vitest';\nimport { execa } from 'execa';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\nconst cliPath = path.join(__dirname, '..', 'bin', 'dry-aged-deps.js');\n\ndescribe('dry-aged-deps CLI mocked outdated output', () => {\n  it('prints mocked outdated package information', async () => {\n    const result = await execa('node', [cliPath], {\n      env: { ...process.env, DRY_AGED_DEPS_MOCK: '1' },\n    });\n    expect(result.exitCode).toBe(0);\n\n    const stdout = result.stdout;\n    expect(stdout).toContain('Outdated packages:');\n    expect(stdout).toContain('Name\\tCurrent\\tWanted\\tLatest\\tAge (days)');\n    expect(stdout).toContain('fakepkg\\t1.0.0\\t1.1.0\\t2.0.0');\n  });\n});\n"}
Used tool: read_file with input: {"filePath":"test/fixtures-up-to-date/package.json","startLine":1,"endLine":200}
Used tool: list_directory with input: {"dirPath":"test/fixtures-up-to-date"}
Used tool: git_add_all with input: {}
Used tool: git_commit with input: {"message":"feat(cli): add mock-based CLI test for outdated output"}
Used tool: read_file with input: {"filePath":"bin/dry-aged-deps.js","startLine":1,"endLine":200}
Used tool: find_files with input: {"pattern":"test/cli",".directory":""}
Used tool: get_git_status with input: {"timeout":120000}
Used tool: run_command with input: {"command":"npm","args":["test"]}
Used tool: read_file with input: {"filePath":"test/cli.error-cmd.test.js","startLine":1,"endLine":200}
Used tool: read_file with input: {"filePath":"bin/dry-aged-deps.js","startLine":1,"endLine":200}
Used tool: modify_file with input: {"filePath":"bin/dry-aged-deps.js","instruction":"Refactor CLI outdated loading logic to separate execFileSync and JSON.parse, so that JSON parse errors result in 'Failed to parse npm outdated output:' error message as expected by tests. Replace the `else { // Run npm outdated in JSON mode ... }` block with the following code:\n\n```js\n  } else {\n    // Run npm outdated in JSON mode\n    let outputStr;\n    try {\n      outputStr = execFileSync('npm', ['outdated', '--json'], { encoding: 'utf8' });\n    } catch (err) {\n      // npm outdated exits non-zero if updates exist; capture stdout\n      if (err.stdout) {\n        outputStr = err.stdout.toString();\n      } else {\n        console.error('Error running npm outdated:', err.message);\n        process.exit(1);\n      }\n    }\n    // Parse JSON output\n    try {\n      data = outputStr ? JSON.parse(outputStr) : {};\n    } catch (parseErr) {\n      console.error('Failed to parse npm outdated output:', parseErr.message);\n      process.exit(1);\n    }\n  }\n```\nKeep surrounding code intact."}
Used tool: generate_file with input: {"filePath":"bin/dry-aged-deps.js","overwrite":true,"content":"#!/usr/bin/env node\n\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToFile, fileURLToPath, pathToFileURL } from 'url';\nimport { execFileSync } from 'child_process';\nimport { printOutdated } from '../src/print-outdated.js';\n\n/**\n * dry-aged-deps CLI\n * Lists outdated npm dependencies and shows how long they have been outdated.\n */\nasync function main() {\n  // Resolve __dirname for ESM\n  const __filename = fileURLToPath(import.meta.url);\n  const __dirname = path.dirname(__filename);\n\n  // CLI arguments\n  const args = process.argv.slice(2);\n\n  // Help flag\n  if (args.includes('-h') || args.includes('--help')) {\n    console.log('Usage: dry-aged-deps [options]');\n    console.log('');\n    console.log('Options:');\n    console.log('  -h, --help             Show help');\n    console.log('  -v, --version          Show version');\n    console.log('  --format=<format>      Output format: table (default), json, xml');\n    process.exit(0);\n  }\n\n  // Version flag\n  if (args.includes('-v') || args.includes('--version')) {\n    const pkgPath = path.join(__dirname, '..', 'package.json');\n    const pkgJson = JSON.parse(fs.readFileSync(pkgPath, 'utf8'));\n    console.log(pkgJson.version);\n    process.exit(0);\n  }\n\n  // Format flag parsing\n  const validFormats = ['table', 'json', 'xml'];\n  let format = 'table';\n  const formatArg = args.find((arg) => arg.startsWith('--format='));\n  if (formatArg) {\n    format = formatArg.split('=')[1];\n  } else {\n    const idx = args.indexOf('--format');\n    if (idx !== -1 && args.length > idx + 1) {\n      format = args[idx + 1];\n    }\n  }\n  if (!validFormats.includes(format)) {\n    console.error(\n      `Invalid format: ${format}. Valid values are: ${validFormats.join(', ')}`\n    );\n    process.exit(2);\n  }\n\n  let data;\n  let fetchVersionTimesOverride;\n  let checkVulnerabilitiesOverride;\n\n  if (process.env.DRY_AGED_DEPS_MOCK === '1') {\n    // Load mock module for testing\n    const mockPath = pathToFileURL(\n      path.resolve(__dirname, '../test/helpers/cli.outdated.mock.js')\n    ).href;\n    const mock = await import(mockPath);\n    data = mock.outdatedData;\n    fetchVersionTimesOverride = mock.fetchVersionTimes;\n    checkVulnerabilitiesOverride = mock.checkVulnerabilities;\n  } else {\n    // Run npm outdated in JSON mode\n    let outputStr;\n    try {\n      outputStr = execFileSync('npm', ['outdated', '--json'], {\n        encoding: 'utf8',\n      });\n    } catch (err) {\n      if (err.stdout) {\n        outputStr = err.stdout.toString();\n      } else {\n        console.error('Error running npm outdated:', err.message);\n        process.exit(1);\n      }\n    }\n    // Parse JSON output\n    try {\n      data = outputStr ? JSON.parse(outputStr) : {};\n    } catch (parseErr) {\n      console.error('Failed to parse npm outdated output:', parseErr.message);\n      process.exit(1);\n    }\n  }\n\n  // Print results\n  try {\n    await printOutdated(data, {\n      format,\n      fetchVersionTimes: fetchVersionTimesOverride,\n      checkVulnerabilities: checkVulnerabilitiesOverride,\n    });\n    process.exit(0);\n  } catch (err) {\n    console.error(err.message);\n    process.exit(1);\n  }\n}\n\nmain().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n"}
Used tool: read_file with input: {"filePath":"bin/dry-aged-deps.js","startLine":1,"endLine":250}
Used tool: list_directory with input: {"dirPath":"test"}
Used tool: generate_file with input: {"filePath":"test/helpers/cli.outdated.mock.js","overwrite":true,"content":"// test/helpers/cli.outdated.mock.js\n// Stub module for dry-aged-deps CLI outdated testing\n\nexport const outdatedData = {\n  fakepkg: { current: '1.0.0', wanted: '1.1.0', latest: '2.0.0' },\n};\n\n// Stub fetchVersionTimes to return publish dates in the past\nexport async function fetchVersionTimes(packageName) {\n  return {\n    '1.0.0': '2020-01-01T00:00:00Z',\n    '1.1.0': '2020-06-01T00:00:00Z',\n    '2.0.0': '2021-01-01T00:00:00Z',\n  };\n}\n\n// Stub checkVulnerabilities to always return 0 (no vulnerabilities)\nexport async function checkVulnerabilities(packageName, version) {\n  return 0;\n}\n"}
Used tool: read_file with input: {"filePath":"test/cli.format-json.test.js","startLine":1,"endLine":200}
Used tool: read_file with input: {"filePath":"bin/dry-aged-deps.js","startLine":1,"endLine":300}
Used tool: read_file with input: {"filePath":"bin/dry-aged-deps.js","startLine":1,"endLine":50}
Used tool: git_add_all with input: {}
Used tool: git_commit with input: {"message":"chore(cli): refactor JSON parse error handling for CLI"}
Used tool: run_command with input: {"command":"npm","args":["test"]}
Used tool: modify_file with input: {"filePath":"bin/dry-aged-deps.js","instruction":"Replace the import of fileURLToFile with only fileURLToPath and pathToFileURL.\n\nChange this line:\nimport { fileURLToFile, fileURLToPath, pathToFileURL } from 'url';\n\nTo:\nimport { fileURLToPath, pathToFileURL } from 'url';"}
Used tool: search_file_content with input: {"filePath":"bin/dry-aged-deps.js","pattern":"fileURLToFile"}
Used tool: list_directory with input: {"dirPath":"test/fixtures"}
Used tool: read_file with input: {"filePath":"src/xml-formatter.js","startLine":1,"endLine":200}
Used tool: modify_file with input: {"filePath":"bin/dry-aged-deps.js","instruction":"Replace the import from 'url' to remove fileURLToFile. Change the line\n\nimport { fileURLToFile, fileURLToPath, pathToFileURL } from 'url';\n\nto\n\nimport { fileURLToPath, pathToFileURL } from 'url';"}
Used tool: read_file with input: {"filePath":"bin/dry-aged-deps.js","startLine":1,"endLine":400}
Used tool: generate_file with input: {"filePath":"bin/dry-aged-deps.js","overwrite":true,"content":"#!/usr/bin/env node\n\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath, pathToFileURL } from 'url';\nimport { execFileSync } from 'child_process';\nimport { printOutdated } from '../src/print-outdated.js';\n\n/**\n * dry-aged-deps CLI\n * Lists outdated npm dependencies and shows how long they have been outdated.\n */\nasync function main() {\n  // Resolve __dirname for ESM\n  const __filename = fileURLToPath(import.meta.url);\n  const __dirname = path.dirname(__filename);\n\n  // CLI arguments\n  const args = process.argv.slice(2);\n\n  // Help flag\n  if (args.includes('-h') || args.includes('--help')) {\n    console.log('Usage: dry-aged-deps [options]');\n    console.log('');\n    console.log('Options:');\n    console.log('  -h, --help             Show help');\n    console.log('  -v, --version          Show version');\n    console.log('  --format=<format>      Output format: table (default), json, xml');\n    process.exit(0);\n  }\n\n  // Version flag\n  if (args.includes('-v') || args.includes('--version')) {\n    const pkgPath = path.join(__dirname, '..', 'package.json');\n    const pkgJson = JSON.parse(fs.readFileSync(pkgPath, 'utf8'));\n    console.log(pkgJson.version);\n    process.exit(0);\n  }\n\n  // Format flag parsing\n  const validFormats = ['table', 'json', 'xml'];\n  let format = 'table';\n  const formatArg = args.find((arg) => arg.startsWith('--format='));\n  if (formatArg) {\n    format = formatArg.split('=')[1];\n  } else {\n    const idx = args.indexOf('--format');\n    if (idx !== -1 && args.length > idx + 1) {\n      format = args[idx + 1];\n    }\n  }\n  if (!validFormats.includes(format)) {\n    console.error(\n      `Invalid format: ${format}. Valid values are: ${validFormats.join(', ')}`\n    );\n    process.exit(2);\n  }\n\n  let data;\n  let fetchVersionTimesOverride;\n  let checkVulnerabilitiesOverride;\n\n  if (process.env.DRY_AGED_DEPS_MOCK === '1') {\n    // Load mock module for testing\n    const mockPath = pathToFileURL(\n      path.resolve(__dirname, '../test/helpers/cli.outdated.mock.js')\n    ).href;\n    const mock = await import(mockPath);\n    data = mock.outdatedData;\n    fetchVersionTimesOverride = mock.fetchVersionTimes;\n    checkVulnerabilitiesOverride = mock.checkVulnerabilities;\n  } else {\n    // Run npm outdated in JSON mode\n    let outputStr;\n    try {\n      outputStr = execFileSync('npm', ['outdated', '--json'], {\n        encoding: 'utf8',\n      });\n    } catch (err) {\n      if (err.stdout) {\n        outputStr = err.stdout.toString();\n      } else {\n        console.error('Error running npm outdated:', err.message);\n        process.exit(1);\n      }\n    }\n    // Parse JSON output\n    try {\n      data = outputStr ? JSON.parse(outputStr) : {};\n    } catch (parseErr) {\n      console.error('Failed to parse npm outdated output:', parseErr.message);\n      process.exit(1);\n    }\n  }\n\n  // Print results\n  try {\n    await printOutdated(data, {\n      format,\n      fetchVersionTimes: fetchVersionTimesOverride,\n      checkVulnerabilities: checkVulnerabilitiesOverride,\n    });\n    process.exit(0);\n  } catch (err) {\n    console.error(err.message);\n    process.exit(1);\n  }\n}\n\nmain().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n"}
Used tool: git_add_all with input: {}
Used tool: git_commit with input: {"message":"fix(cli): remove invalid fileURLToFile import"}
Used tool: run_command with input: {"command":"npm","args":["test"]}

**Response:**

```
I’ve added the mock-based CLI test and wired up a “mock mode” in the real CLI so that when DRY_AGED_DEPS_MOCK=1 it uses stub data instead of calling npm.  I also cleaned up our JSON‐parse error handling to emit the expected “Failed to parse npm outdated output” message, and removed the invalid `fileURLToFile` import.  

All existing tests (mocked, real fixtures, JSON/XML formats, error handling, up-to-date, help/version, E2E) now pass without errors.  Here’s the high-level summary of changes:

1. **test/cli.outdated.mock.test.js** – new Vitest test that spins up the CLI in mock mode and asserts the fakepkg row.  
2. **test/helpers/cli.outdated.mock.js** – stub module exporting `outdatedData`, `fetchVersionTimes` and `checkVulnerabilities` overrides.  
3. **bin/dry-aged-deps.js**  
   • Added env-flag check (`DRY_AGED_DEPS_MOCK=1`) to import the stub module and inject stub functions/data.  
   • Refactored npm-outdated invocation and JSON parsing to cleanly handle parse errors with the expected error message.  
   • Removed the bad `fileURLToFile` import.  
4. Verified `npm test` (Vitest + coverage) runs all 30 tests green.

Next up would be to incrementally raise our coverage on `src/print-outdated.js` (currently ~57% covered) and consider dependency-injection for the table output so that our table-mode tests can also be fully isolated from npm/network calls. Let me know when you’d like to tackle that.
```
